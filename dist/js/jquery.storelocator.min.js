/*! jQuery Google Maps Store Locator - v1.4.9 - 2014-07-12
* http://www.bjornblog.com/web/jquery-store-locator-plugin
* Copyright (c) 2014 Bjorn Holine; Licensed MIT */

!function(a,b,c,d){"use strict";a.fn.storeLocator=function(b){var e=a.extend({mapDiv:"map",listDiv:".bh-storelocator-loc-list",formContainerDiv:".bh-storelocator-form-container",formID:"user-location",inputID:"address",regionID:"region",mapSettings:{zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP},pinColor:"fe7569",pinTextColor:"000000",lengthUnit:"m",storeLimit:26,distanceAlert:60,dataType:"xml",dataLocation:"data/locations.xml",xmlElement:"marker",listColor1:"ffffff",listColor2:"eeeeee",originMarker:!1,originpinColor:"blue",bounceMarker:!0,slideMap:!0,modalWindow:!1,overlayDiv:"bh-storelocator-overlay",modalWindowDiv:"bh-storelocator-modal-window",modalContentDiv:"bh-storelocator-modal-content",modalCloseIconDiv:"bh-storelocator-modal-close-icon",defaultLoc:!1,defaultLat:"",defaultLng:"",autoGeocode:!1,maxDistance:!1,maxDistanceID:"maxdistance",fullMapStart:!1,noForm:!1,loading:!1,loadingDiv:"bh-storelocator-loading",featuredLocations:!1,pagination:!1,locationsPerPage:10,infowindowTemplatePath:"templates/infowindow-description.html",listTemplatePath:"templates/location-list-description.html",KMLinfowindowTemplatePath:"templates/kml-infowindow-description.html",KMLlistTemplatePath:"templates/kml-location-list-description.html",listTemplateID:null,infowindowTemplateID:null,taxonomyFilters:null,callbackBeforeSend:null,callbackComplete:null,callbackSuccess:null,callbackModalOpen:null,callbackModalClose:null,jsonpCallback:null,geocodeErrorAlert:"Geocode was not successful for the following reason: ",addressErrorAlert:"Unable to find address",autoGeocodeErrorAlert:"Automatic location detection failed. Please fill in your address or zip code.",distanceErrorAlert:"Unfortunately, our closest location is more than ",mileLang:"mile",milesLang:"miles",kilometerLang:"kilometer",kilometersLang:"kilometers",noResultsTitle:"No results",noResultsDesc:"No locations were found with the given criteria. Please modify your selections or input."},b);return this.each(function(){function f(){O=[],N=[],P=[],R=[],a(c).off("click."+V,e.listDiv+" li")}function g(){var b=a.Deferred();return a.ajax({type:"GET",url:e.dataLocation+("jsonp"===e.dataType?(e.dataLocation.match(/\?/)?"&":"?")+"callback=?":""),dataType:G,jsonpCallback:"jsonp"===e.dataType?e.jsonpCallback:null}).done(function(a){b.resolve(a)}).fail(b.reject),b.promise()}function h(){var a=0;if(!o(S))for(var b in S)S.hasOwnProperty(b)&&(a+=S[b].length);return a}function i(){a.each(e.taxonomyFilters,function(b,c){a(c+" input[type=checkbox]").each(function(){if(a(this).prop("checked")){var c=a(this).attr("id");-1===S[b].indexOf(c)&&S[b].push(c)}}),a(c+" select").each(function(){var c=a(this).attr("id");-1===S[b].indexOf(c)&&S[b].push(c)})})}function j(a){for(var b in e.taxonomyFilters)if(e.taxonomyFilters.hasOwnProperty(b))for(var c=0;c<e.taxonomyFilters[b].length;c++)if(e.taxonomyFilters[b]===a)return b}function k(){if(e.defaultLoc===!0){var a=new m,b=new google.maps.LatLng(e.defaultLat,e.defaultLng);a.geocode({latLng:b},function(a){if(null!==a){var b=a.address;C(H,e.defaultLat,e.defaultLng,b)}else alert(e.addressErrorAlert)})}e.fullMapStart===!0&&C(H),e.autoGeocode===!0&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(y,z)}function l(){var a=new google.maps.Geocoder;this.geocode=function(b,c){a.geocode(b,function(a,b){if(b===google.maps.GeocoderStatus.OK){var d={};d.latitude=a[0].geometry.location.lat(),d.longitude=a[0].geometry.location.lng(),c(d)}else alert(e.geocodeErrorAlert+b),c(null)})}}function m(){var a=new google.maps.Geocoder;this.geocode=function(b,c){a.geocode(b,function(a,b){if(b===google.maps.GeocoderStatus.OK){if(a[0]){var d={};d.address=a[0].formatted_address,c(d)}}else alert(e.geocodeErrorAlert+b),c(null)})}}function n(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)}function o(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function p(){e.callbackModalOpen&&e.callbackModalOpen.call(this),a("."+e.overlayDiv).hide()}function q(a){var b;for(var c in O[a])O[a].hasOwnProperty(c)&&(b=O[a][c],"distance"===c&&(b=n(b,2)),T[c]=b)}function r(a){a.sort(function(a,b){return a.distance<b.distance?-1:a.distance>b.distance?1:0})}function s(a,b){var c=!0;for(var d in b)new RegExp(b[d].join("")).test(a[d])||(c=!1);return c?!0:void 0}function t(b){if(0===a(".bh-storelocator-pagination-container ol").length){b===d&&(b=0);for(var c="",f=0;f<O.length/e.locationsPerPage;f++){var g=f+1;c+=f===b?'<li data-page="'+f+'" class="bh-storelocator-current">'+g+"</li>":'<li data-page="'+f+'">'+g+"</li>"}a(".bh-storelocator-pagination-container").append('<ol class="bh-storelocator-pagination">'+c+"</ol>")}}function u(a,b,c,d,f){var g,h=new google.maps.MarkerImage("https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld="+d+"|"+e.pinColor+"|"+e.pinTextColor,new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34));return g=new google.maps.Marker(-1===e.storeLimit||e.storeLimit>26?{position:a,map:f,draggable:!1}:{position:a,map:f,icon:h,draggable:!1})}function v(b,c,d){var f="";q(b.get("id"));var g;g=T.distance<=1?"km"===e.lengthUnit?e.kilometerLang:e.mileLang:"km"===e.lengthUnit?e.kilometersLang:e.milesLang;var h=b.get("id");f=-1===e.storeLimit||e.storeLimit>26?h+1:String.fromCharCode(d>0?"A".charCodeAt(0)+(c+h):"A".charCodeAt(0)+h);var i={location:[a.extend(T,{markerid:h,marker:f,length:g,origin:J})]};return i}function w(b,c,d){var f=v(b,c,d),g=E(f);a(e.listDiv+" ul").append(g)}function x(b,c,d,f,g){var h=v(b,f,g),i=F(h);"left"===c?(d.setContent(i),d.open(b.get("map"),b)):google.maps.event.addListener(b,"click",function(){d.setContent(i),d.open(b.get("map"),b),a(e.listDiv+" li").removeClass("list-focus");var c=b.get("id");a(e.listDiv+" li[data-markerid="+c+"]").addClass("list-focus");var f=a(e.listDiv),g=a(e.listDiv+" li[data-markerid="+c+"]");a(e.listDiv).animate({scrollTop:g.offset().top-f.offset().top+f.scrollTop()})})}function y(a){var b=new m,c=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);b.geocode({latLng:c},function(b){if(null!==b){var c=b.address;C(H,a.coords.latitude,a.coords.longitude,c)}else alert(e.addressErrorAlert)})}function z(){alert(e.autoGeocodeErrorAlert)}function A(b){var c;e.maxDistance===!0&&(c=a("#"+e.maxDistanceID).val()),f(),C(H,K,L,J,c,b)}function B(b){J=a("#"+e.inputID).val();var c=a("#"+e.regionID).val();if(""===J)k();else{var d=new l,f=J;d.geocode({address:f,region:c},function(a){null!==a?(K=a.latitude,L=a.longitude,C(H,K,L,J,b)):alert(e.addressErrorAlert)})}}function C(g,h,i,j,k,l){a(function(){google.maps.visualRefresh=!0;var j=new google.maps.LatLng(h,i);l===d&&(l=0),W.then(function(){e.callbackSuccess&&e.callbackSuccess.call(this,g,xhr,b);var m,n=0,q=[],v=[];if(e.fullMapStart===!0&&a("#"+e.mapDiv).hasClass("bh-storelocator-map-open")===!1?m=!0:f(),a("#"+e.mapDiv).addClass("bh-storelocator-map-open"),"json"===e.dataType||"jsonp"===e.dataType?a.each(g,function(){var a,b,c={};for(a in this)this.hasOwnProperty(a)&&(b=this[a],"web"===a&&b&&(b=b.replace("http://","")),c[a]=b);if(c.distance||(c.distance=U.CalcDistance(h,i,c.lat,c.lng,U.EarthRadius)),e.maxDistance===!0&&m!==!0&&k){if(!(c.distance<k))return;O[n]=c}else O[n]=c;n++}):"kml"===e.dataType?a(g).find("Placemark").each(function(){var b={name:a(this).find("name").text(),lat:a(this).find("coordinates").text().split(",")[1],lng:a(this).find("coordinates").text().split(",")[0],description:a(this).find("description").text()};if(b.distance=U.CalcDistance(h,i,b.lat,b.lng,U.EarthRadius),e.maxDistance===!0&&m!==!0&&k){if(!(b.distance<k))return;O[n]=b}else O[n]=b;n++}):a(g).find(e.xmlElement).each(function(){var b={};if(a.each(this.attributes,function(a,c){b[c.name]=c.value}),b.web&&(b.web=b.web.replace("http://","")),!b.distance){b.distance=U.CalcDistance(h,i,b.lat,b.lng,U.EarthRadius);var c=new google.maps.LatLng(b.lat,b.lng);q[n]=j,v[n]=c}if(e.maxDistance===!0&&m!==!0&&k){if(!(b.distance<k))return;O[n]=b}else O[n]=b;n++}),null!==e.taxonomyFilters){var y={};if(a.each(S,function(a,b){if(b.length>0)for(var c=0;c<b.length;c++)y[a]||(y[a]=[]),y[a][c]="(?=.*\\b"+b[c].replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")+"\\b)"}),!o(y)){var z=a.grep(O,function(a){return s(a,y)});O=z}}o(O)&&(O[0]={address:e.noResultsDesc,address2:"",lat:"",lng:"",name:e.noResultsTitle}),r(O),e.featuredLocations===!0&&(N=a.grep(O,function(a){return"true"===a.featured}),P=a.grep(O,function(a){return"true"!==a.featured}),O=[],O=N.concat(P));var B="km"===e.lengthUnit?e.kilometersLang:e.milesLang;if(e.maxDistance===!0&&m!==!0&&k){if(O[0]===d||O[0].distance>k)return void alert(e.distanceErrorAlert+k+" "+B)}else-1!==e.distanceAlert&&O[0].distance>e.distanceAlert&&alert(e.distanceErrorAlert+e.distanceAlert+" "+B);e.pagination===!0&&t(),a(function(){var b,d,f;if(e.slideMap===!0&&Q.slideDown(),e.modalWindow===!0&&(e.callbackModalOpen&&e.callbackModalOpen.call(this),a("."+e.overlayDiv).fadeIn(),a(c).on("click."+V,"."+e.modalCloseIconDiv+", ."+e.overlayDiv,function(){p()}),a(c).on("click."+V,e.modalWindowDiv,function(a){a.stopPropagation()}),a(c).on("keyup."+V,function(a){27===a.keyCode&&p()})),M=-1===e.storeLimit||O.length<e.storeLimit?O.length:e.storeLimit,e.pagination===!0?(d=e.locationsPerPage,b=l*e.locationsPerPage,O=O.slice(b,b+d),M=O.length):(d=M,b=0),e.fullMapStart===!0&&m===!0||0===e.mapSettings.zoom){f=e.mapSettings;var g=new google.maps.LatLngBounds}else if(e.pagination===!0){var h=new google.maps.LatLng(O[0].lat,O[0].lng);0===l?(e.mapSettings.center=j,f=e.mapSettings):(e.mapSettings.center=h,f=e.mapSettings)}else e.mapSettings.center=j,f=e.mapSettings;var i=new google.maps.Map(c.getElementById(e.mapDiv.replace("#")),f);Q.data(e.mapDiv.replace("#"),i);var k=new google.maps.InfoWindow;if(e.originMarker===!0&&e.fullMapStart===!1)var n=new google.maps.Marker({position:j,map:i,icon:"https://maps.google.com/mapfiles/ms/icons/"+e.originpinColor+"-dot.png",draggable:!1});a(c).on("click."+V,".bh-storelocator-pagination li",function(){a(".bh-storelocator-pagination li").attr("class",""),a(this).addClass("bh-storelocator-current"),A(a(this).attr("data-page"))});for(var o=0;d-1>=o;o++){var q="";q=String.fromCharCode(l>0?"A".charCodeAt(0)+(b+o):"A".charCodeAt(0)+o);var r=new google.maps.LatLng(O[o].lat,O[o].lng);n=u(r,O[o].name,O[o].address,q,i),n.set("id",o),R[o]=n,(e.fullMapStart===!0&&m===!0||0===e.mapSettings.zoom)&&g.extend(r),x(n,null,k,b,l)}(e.fullMapStart===!0&&m===!0||0===e.mapSettings.zoom)&&i.fitBounds(g),a(e.listDiv+" ul").empty(),a(R).each(function(a){var c=(String.fromCharCode("A".charCodeAt(0)+a),R[a]);w(c,b,l)}),a(c).on("click."+V,e.listDiv+" li",function(){var c=a(this).data("markerid"),d=R[c];a(e.listDiv+" li").removeClass("list-focus"),a(e.listDiv+" li[data-markerid="+c+"]").addClass("list-focus"),i.panTo(d.getPosition());var f="left";e.bounceMarker===!0?(d.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){d.setAnimation(null),x(d,f,k,b,l)},700)):x(d,f,k,b,l)}),a(e.listDiv+" ul li:even").css("background","#"+e.listColor1),a(e.listDiv+" ul li:odd").css("background","#"+e.listColor2)})})})}function D(){null!==e.taxonomyFilters&&(a.each(e.taxonomyFilters,function(a){S[a]=[]}),a(".bh-storelocator-filters-container").on("change."+V,"input, select",function(b){b.stopPropagation();var c,d,g;if(a(this).is('input[type="checkbox"]')){if(i(),c=a(this).val(),d=a(this).closest(".bh-storelocator-filters").attr("id"),g=j(d))if(a(this).prop("checked"))S[g].push(c),a("#"+e.mapDiv).hasClass("bh-storelocator-map-open")===!0&&(f(),K&&L?(e.mapSettings.zoom=0,B()):C(H));else{var k=S[g].indexOf(c);k>-1&&(S[g].splice(k,1),a("#"+e.mapDiv).hasClass("bh-storelocator-map-open")===!0&&(f(),K&&L?(e.mapSettings.zoom=0===h()?I:0,B()):C(H)))}}else(a(this).is("select")||a(this).is('input[type="radio"]'))&&(i(),c=a(this).val(),d=a(this).closest(".bh-storelocator-filters").attr("id"),g=j(d),c?g&&(S[g]=[c],a("#"+e.mapDiv).hasClass("bh-storelocator-map-open")===!0&&(f(),K&&L?(e.mapSettings.zoom=0,B()):C(H))):(g&&(S[g]=[]),f(),K&&L?(e.mapSettings.zoom=I,B()):C(H)))})),e.modalWindow===!0&&(Q.wrap('<div class="'+e.overlayDiv+'"><div class="'+e.modalWindowDiv+'"><div class="'+e.modalContentDiv+'">'),a("."+e.modalWindowDiv).prepend('<div class="'+e.modalCloseIconDiv+'"></div>'),a("."+e.overlayDiv).hide()),e.slideMap===!0&&Q.hide(),k(),a(function(){function b(b){if(b.preventDefault(),e.maxDistance===!0){var c=a("#"+e.maxDistanceID).val();B(c)}else B()}e.noForm===!0?(a(c).on("click."+V,"."+e.formContainerDiv+" button",function(a){b(a)}),a(c).on("keyup."+V,function(c){13===c.keyCode&&a("#"+e.inputID).is(":focus")&&b(c)})):a(c).on("submit."+V,"#"+e.formID,function(a){b(a)})})}var E,F,G,H,I,J,K,L,M,N,O,P,Q=a(this),R=[],S={},T={},U={},V="storeLocator";U.EarthRadius="km"===e.lengthUnit?6367:3956,U.ToRadian=function(a){return a*(Math.PI/180)},U.DiffRadian=function(a,b){return U.ToRadian(b)-U.ToRadian(a)},U.CalcDistance=function(a,b,c,d,e){return 2*e*Math.asin(Math.min(1,Math.sqrt(Math.pow(Math.sin(U.DiffRadian(a,c)/2),2)+Math.cos(U.ToRadian(a))*Math.cos(U.ToRadian(c))*Math.pow(Math.sin(U.DiffRadian(b,d)/2),2))))},G="kml"===e.dataType?"xml":e.dataType;var W=g();W.done(function(a){H=a}),I=e.mapSettings.zoom,"kml"===e.dataType&&null===e.listTemplateID&&null===e.infowindowTemplateID?a.when(a.get(e.KMLinfowindowTemplatePath,function(a){var b=a;F=Handlebars.compile(b)}),a.get(e.KMLlistTemplatePath,function(a){var b=a;E=Handlebars.compile(b)})).then(function(){D()},function(){}):null!==e.listTemplateID&&null!==e.infowindowTemplateID?(F=Handlebars.compile(a(e.infowindowTemplateID).html()),E=Handlebars.compile(a(e.listTemplateID).html()),D()):a.when(a.get(e.infowindowTemplatePath,function(a){var b=a;F=Handlebars.compile(b)}),a.get(e.listTemplatePath,function(a){var b=a;E=Handlebars.compile(b)})).then(function(){D()},function(){})})}}(jQuery,window,document);