/*! jQuery Google Maps Store Locator - v1.4.9 - 2014-07-14
* http://www.bjornblog.com/web/jquery-store-locator-plugin
* Copyright (c) 2014 Bjorn Holine; Licensed MIT */

!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.settings=a.extend({},z,c),this._defaults=z,this._name=f,this.init()}var f="storeLocator";if("undefined"==typeof a.fn[f]){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=[],v={},w={},x={},y="storeLocator",z={mapDiv:"map",listDiv:".bh-storelocator-loc-list",formContainerDiv:"bh-storelocator-form-container",formID:"user-location",inputID:"address",regionID:"region",mapSettings:{zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP},pinColor:"fe7569",pinTextColor:"000000",lengthUnit:"m",storeLimit:26,distanceAlert:60,dataType:"xml",dataLocation:"data/locations.xml",xmlElement:"marker",listColor1:"ffffff",listColor2:"eeeeee",originMarker:!1,originpinColor:"blue",bounceMarker:!0,slideMap:!0,modalWindow:!1,overlayDiv:"bh-storelocator-overlay",modalWindowDiv:"bh-storelocator-modal-window",modalContentDiv:"bh-storelocator-modal-content",modalCloseIconDiv:"bh-storelocator-modal-close-icon",defaultLoc:!1,defaultLat:"",defaultLng:"",autoGeocode:!1,maxDistance:!1,maxDistanceID:"maxdistance",fullMapStart:!1,noForm:!1,loading:!1,loadingDiv:"bh-storelocator-loading",featuredLocations:!1,pagination:!1,locationsPerPage:10,infowindowTemplatePath:"templates/infowindow-description.html",listTemplatePath:"templates/location-list-description.html",KMLinfowindowTemplatePath:"templates/kml-infowindow-description.html",KMLlistTemplatePath:"templates/kml-location-list-description.html",listTemplateID:null,infowindowTemplateID:null,taxonomyFilters:null,callbackBeforeSend:null,callbackComplete:null,callbackSuccess:null,callbackModalOpen:null,callbackModalClose:null,jsonpCallback:null,geocodeErrorAlert:"Geocode was not successful for the following reason: ",addressErrorAlert:"Unable to find address",autoGeocodeErrorAlert:"Automatic location detection failed. Please fill in your address or zip code.",distanceErrorAlert:"Unfortunately, our closest location is more than ",mileLang:"mile",milesLang:"miles",kilometerLang:"kilometer",kilometersLang:"kilometers",noResultsTitle:"No results",noResultsDesc:"No locations were found with the given criteria. Please modify your selections or input."};a.extend(e.prototype,{geoCodeCalcToRadian:function(a){return a*(Math.PI/180)},geoCodeCalcDiffRadian:function(a,b){return this.geoCodeCalcToRadian(b)-this.geoCodeCalcToRadian(a)},geoCodeCalcCalcDistance:function(a,b,c,d,e){return 2*e*Math.asin(Math.min(1,Math.sqrt(Math.pow(Math.sin(this.geoCodeCalcDiffRadian(a,c)/2),2)+Math.cos(this.geoCodeCalcToRadian(a))*Math.cos(this.geoCodeCalcToRadian(c))*Math.pow(Math.sin(this.geoCodeCalcDiffRadian(b,d)/2),2))))},init:function(){var b,c=this;x.EarthRadius="km"===this.settings.lengthUnit?6367:3956,j="kml"===this.settings.dataType?"xml":this.settings.dataType,l=this.getData(),l.done(function(a){k=a}),m=this.settings.mapSettings.zoom,"kml"===this.settings.dataType&&null===this.settings.listTemplateID&&null===this.settings.infowindowTemplateID?a.when(a.get(this.settings.KMLinfowindowTemplatePath,function(a){b=a,i=Handlebars.compile(b)}),a.get(this.settings.KMLlistTemplatePath,function(a){b=a,h=Handlebars.compile(b)})).then(function(){c.locator()},function(){}):null!==this.settings.listTemplateID&&null!==this.settings.infowindowTemplateID?(i=Handlebars.compile(a(this.settings.infowindowTemplateID).html()),h=Handlebars.compile(a(this.settings.listTemplateID).html()),c.locator()):a.when(a.get(this.settings.infowindowTemplatePath,function(a){b=a,i=Handlebars.compile(b)}),a.get(this.settings.listTemplatePath,function(a){b=a,h=Handlebars.compile(b)})).then(function(){c.locator()},function(){})},reset:function(){s=[],r=[],t=[],u=[],a(c).off("click."+y,this.settings.listDiv+" li")},getFormValues:function(b){if(b.preventDefault(),this.settings.maxDistance===!0){var c=a("#"+this.settings.maxDistanceID).val();this.beginMapping(c)}else this.beginMapping()},processFormInput:function(){var b=this;this.settings.noForm===!0?(a(c).on("click."+y,"."+this.settings.formContainerDiv+" button",function(a){b.getFormValues(a)}),a(c).on("keyup."+y,function(c){13===c.keyCode&&a("#"+b.settings.inputID).is(":focus")&&b.getFormValues(c)})):a(c).on("submit."+y,"#"+this.settings.formID,function(a){b.getFormValues(a)})},getData:function(){var b=a.Deferred();return a.ajax({type:"GET",url:this.settings.dataLocation+("jsonp"===this.settings.dataType?(this.settings.dataLocation.match(/\?/)?"&":"?")+"callback=?":""),dataType:j,jsonpCallback:"jsonp"===this.settings.dataType?this.settings.jsonpCallback:null}).done(function(a){b.resolve(a)}).fail(b.reject),b.promise()},countFilters:function(){var a=0;if(!this.isEmptyObject(v))for(var b in v)v.hasOwnProperty(b)&&(a+=v[b].length);return a},checkFilters:function(){a.each(this.settings.taxonomyFilters,function(b,c){a(c+" input[type=checkbox]").each(function(){if(a(this).prop("checked")){var c=a(this).attr("id");-1===v[b].indexOf(c)&&v[b].push(c)}}),a(c+" select").each(function(){var c=a(this).attr("id");-1===v[b].indexOf(c)&&v[b].push(c)})})},getFilterKey:function(a){for(var b in this.settings.taxonomyFilters)if(this.settings.taxonomyFilters.hasOwnProperty(b))for(var c=0;c<this.settings.taxonomyFilters[b].length;c++)if(this.settings.taxonomyFilters[b]===a)return b},start:function(){var a=this;if(this.settings.defaultLoc===!0){var b=new this.reverseGoogleGeocode,c=new google.maps.LatLng(this.settings.defaultLat,this.settings.defaultLng);b.geocode({latLng:c},function(b){if(null!==b){var c=b.address;a.mapping(k,a.settings.defaultLat,a.settings.defaultLng,c)}else alert(this.settings.addressErrorAlert)})}this.settings.fullMapStart===!0&&this.mapping(k),this.settings.autoGeocode===!0&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){a.autoGeocodeQuery(b)},function(b){a.autoGeocodeError(b)})},googleGeocode:function(){var a=new google.maps.Geocoder;this.geocode=function(b,c){a.geocode(b,function(a,b){if(b===google.maps.GeocoderStatus.OK){var d={};d.latitude=a[0].geometry.location.lat(),d.longitude=a[0].geometry.location.lng(),c(d)}else alert(this.settings.geocodeErrorAlert+b),c(null)})}},reverseGoogleGeocode:function(){var a=new google.maps.Geocoder;this.geocode=function(b,c){a.geocode(b,function(a,b){if(b===google.maps.GeocoderStatus.OK){if(a[0]){var d={};d.address=a[0].formatted_address,c(d)}}else alert(this.settings.geocodeErrorAlert+b),c(null)})}},roundNumber:function(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)},isEmptyObject:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},modalClose:function(){this.settings.callbackModalOpen&&this.settings.callbackModalOpen.call(this),a("."+this.settings.overlayDiv).hide()},createLocationVariables:function(a){var b;for(var c in s[a])s[a].hasOwnProperty(c)&&(b=s[a][c],"distance"===c&&(b=this.roundNumber(b,2)),w[c]=b)},sortNumerically:function(a){a.sort(function(a,b){return a.distance<b.distance?-1:a.distance>b.distance?1:0})},filterData:function(a,b){var c=!0;for(var d in b)new RegExp(b[d].join("")).test(a[d])||(c=!1);return c?!0:void 0},paginationSetup:function(b){if(0===a(".bh-storelocator-pagination-container ol").length){b===d&&(b=0);for(var c="",e=0;e<s.length/this.settings.locationsPerPage;e++){var f=e+1;c+=e===b?'<li data-page="'+e+'" class="bh-storelocator-current">'+f+"</li>":'<li data-page="'+e+'">'+f+"</li>"}a(".bh-storelocator-pagination-container").append('<ol class="bh-storelocator-pagination">'+c+"</ol>")}},calcRoute:function(a,b){var c,d=new google.maps.DirectionsService;c="m"===this.settings.lengthUnit?google.maps.UnitSystem.IMPERIAL:google.maps.UnitSystem.METRIC;var e={origin:a,destination:b,travelMode:google.maps.TravelMode.DRIVING,unitSystem:c};d.route(e,function(a,b){return b===google.maps.DirectionsStatus.OK?a:void 0})},calculateDistances:function(a,b){var c=new google.maps.DistanceMatrixService,d={origins:a,destinations:b,travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.IMPERIAL,avoidHighways:!1,avoidTolls:!1};c.getDistanceMatrix(d,function(a,b){return b===google.maps.DistanceMatrixStatus.OK?a:void 0})},createMarker:function(a,b,c,d,e){var f,g=new google.maps.MarkerImage("https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld="+d+"|"+this.settings.pinColor+"|"+this.settings.pinTextColor,new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34));return f=new google.maps.Marker(-1===this.settings.storeLimit||this.settings.storeLimit>26?{position:a,map:e,draggable:!1}:{position:a,map:e,icon:g,draggable:!1})},defineLocationData:function(b,c,d){var e="";this.createLocationVariables(b.get("id"));var f;f=w.distance<=1?"km"===this.settings.lengthUnit?this.settings.kilometerLang:this.settings.mileLang:"km"===this.settings.lengthUnit?this.settings.kilometersLang:this.settings.milesLang;var g=b.get("id");e=-1===this.settings.storeLimit||this.settings.storeLimit>26?g+1:String.fromCharCode(d>0?"A".charCodeAt(0)+(c+g):"A".charCodeAt(0)+g);var h={location:[a.extend(w,{markerid:g,marker:e,length:f,origin:n})]};return h},listClick:function(b,c,d){var e=this.defineLocationData(b,c,d),f=h(e);a(this.settings.listDiv+" ul").append(f)},createInfowindow:function(b,c,d,e,f){var g=this,h=this.defineLocationData(b,e,f),j=i(h);"left"===c?(d.setContent(j),d.open(b.get("map"),b)):google.maps.event.addListener(b,"click",function(){d.setContent(j),d.open(b.get("map"),b),a(g.settings.listDiv+" li").removeClass("list-focus");var c=b.get("id");a(g.settings.listDiv+" li[data-markerid="+c+"]").addClass("list-focus");var e=a(g.settings.listDiv),f=a(g.settings.listDiv+" li[data-markerid="+c+"]");a(g.settings.listDiv).animate({scrollTop:f.offset().top-e.offset().top+e.scrollTop()})})},autoGeocodeQuery:function(a){var b=this,c=new this.reverseGoogleGeocode,d=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);c.geocode({latLng:d},function(c){if(null!==c){var d=c.address;b.mapping(k,a.coords.latitude,a.coords.longitude,d)}else alert(this.settings.addressErrorAlert)})},autoGeocodeError:function(){alert(this.settings.autoGeocodeErrorAlert)},paginationChange:function(b){var c;this.settings.maxDistance===!0&&(c=a("#"+this.settings.maxDistanceID).val()),this.reset(),this.mapping(k,o,p,n,c,b)},beginMapping:function(b){var c=this;n=a("#"+this.settings.inputID).val();var d=a("#"+this.settings.regionID).val();if(""===n)this.start();else{var e=new this.googleGeocode,f=n;e.geocode({address:f,region:d},function(a){null!==a?(o=a.latitude,p=a.longitude,c.mapping(k,o,p,n,b)):alert(this.settings.addressErrorAlert)})}},mapping:function(b,e,f,h,i,j){var k=this;google.maps.visualRefresh=!0;var m=new google.maps.LatLng(e,f);j===d&&(j=0),l.then(function(){k.settings.callbackSuccess&&k.settings.callbackSuccess.call(k,b,xhr,options);var h,l=0,n=[],o=[];if(k.settings.fullMapStart===!0&&a("#"+k.settings.mapDiv).hasClass("bh-storelocator-map-open")===!1?h=!0:k.reset(),a("#"+k.settings.mapDiv).addClass("bh-storelocator-map-open"),"json"===k.settings.dataType||"jsonp"===k.settings.dataType?a.each(b,function(){var a,b,c={};for(a in this)this.hasOwnProperty(a)&&(b=this[a],"web"===a&&b&&(b=b.replace("http://","")),c[a]=b);if(c.distance||(c.distance=k.geoCodeCalcCalcDistance(e,f,c.lat,c.lng,x.EarthRadius)),k.settings.maxDistance===!0&&h!==!0&&i){if(!(c.distance<i))return;s[l]=c}else s[l]=c;l++}):"kml"===k.settings.dataType?a(b).find("Placemark").each(function(){var b={name:a(this).find("name").text(),lat:a(this).find("coordinates").text().split(",")[1],lng:a(this).find("coordinates").text().split(",")[0],description:a(this).find("description").text()};if(b.distance=k.geoCodeCalcCalcDistance(e,f,b.lat,b.lng,x.EarthRadius),k.settings.maxDistance===!0&&h!==!0&&i){if(!(b.distance<i))return;s[l]=b}else s[l]=b;l++}):a(b).find(k.settings.xmlElement).each(function(){var b={};if(a.each(this.attributes,function(a,c){b[c.name]=c.value}),b.web&&(b.web=b.web.replace("http://","")),!b.distance){b.distance=k.geoCodeCalcCalcDistance(e,f,b.lat,b.lng,x.EarthRadius);var c=new google.maps.LatLng(b.lat,b.lng);n[l]=m,o[l]=c}if(k.settings.maxDistance===!0&&h!==!0&&i){if(!(b.distance<i))return;s[l]=b}else s[l]=b;l++}),null!==k.settings.taxonomyFilters){var p={};if(a.each(v,function(a,b){if(b.length>0)for(var c=0;c<b.length;c++)p[a]||(p[a]=[]),p[a][c]="(?=.*\\b"+b[c].replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")+"\\b)"}),!k.isEmptyObject(p)){var w=a.grep(s,function(a){return k.filterData(a,p)});s=w}}k.isEmptyObject(s)&&(s[0]={address:k.settings.noResultsDesc,address2:"",lat:"",lng:"",name:k.settings.noResultsTitle}),k.sortNumerically(s),k.settings.featuredLocations===!0&&(r=a.grep(s,function(a){return"true"===a.featured}),t=a.grep(s,function(a){return"true"!==a.featured}),s=[],s=r.concat(t));var z="km"===k.settings.lengthUnit?k.settings.kilometersLang:k.settings.milesLang;if(k.settings.maxDistance===!0&&h!==!0&&i){if(s[0]===d||s[0].distance>i)return void alert(k.settings.distanceErrorAlert+i+" "+z)}else-1!==k.settings.distanceAlert&&s[0].distance>k.settings.distanceAlert&&alert(k.settings.distanceErrorAlert+k.settings.distanceAlert+" "+z);k.settings.pagination===!0&&k.paginationSetup(),a(function(){var b,d,e;if(k.settings.slideMap===!0&&g.slideDown(),k.settings.modalWindow===!0&&(k.settings.callbackModalOpen&&k.settings.callbackModalOpen.call(this),a("."+k.settings.overlayDiv).fadeIn(),a(c).on("click."+y,"."+k.settings.modalCloseIconDiv+", ."+k.settings.overlayDiv,function(){k.modalClose()}),a(c).on("click."+y,k.settings.modalWindowDiv,function(a){a.stopPropagation()}),a(c).on("keyup."+y,function(a){27===a.keyCode&&k.modalClose()})),q=-1===k.settings.storeLimit||s.length<k.settings.storeLimit?s.length:k.settings.storeLimit,k.settings.pagination===!0?(d=k.settings.locationsPerPage,b=j*k.settings.locationsPerPage,s=s.slice(b,b+d),q=s.length):(d=q,b=0),k.settings.fullMapStart===!0&&h===!0||0===k.settings.mapSettings.zoom){e=k.settings.mapSettings;var f=new google.maps.LatLngBounds}else if(k.settings.pagination===!0){var i=new google.maps.LatLng(s[0].lat,s[0].lng);0===j?(k.settings.mapSettings.center=m,e=k.settings.mapSettings):(k.settings.mapSettings.center=i,e=k.settings.mapSettings)}else k.settings.mapSettings.center=m,e=k.settings.mapSettings;var l=new google.maps.Map(c.getElementById(k.settings.mapDiv.replace("#")),e);g.data(k.settings.mapDiv.replace("#"),l);var n=new google.maps.InfoWindow;if(k.settings.originMarker===!0&&settings.fullMapStart===!1)var o=new google.maps.Marker({position:m,map:l,icon:"https://maps.google.com/mapfiles/ms/icons/"+k.settings.originpinColor+"-dot.png",draggable:!1});a(c).on("click."+y,".bh-storelocator-pagination li",function(){a(".bh-storelocator-pagination li").attr("class",""),a(this).addClass("bh-storelocator-current"),k.paginationChange(a(this).attr("data-page"))});for(var p=0;d-1>=p;p++){var r="";r=String.fromCharCode(j>0?"A".charCodeAt(0)+(b+p):"A".charCodeAt(0)+p);var t=new google.maps.LatLng(s[p].lat,s[p].lng);o=k.createMarker(t,s[p].name,s[p].address,r,l),o.set("id",p),u[p]=o,(k.settings.fullMapStart===!0&&h===!0||0===k.settings.mapSettings.zoom)&&f.extend(t),k.createInfowindow(o,null,n,b,j)}(k.settings.fullMapStart===!0&&h===!0||0===k.settings.mapSettings.zoom)&&l.fitBounds(f),a(k.settings.listDiv+" ul").empty(),a(u).each(function(a){var c=(String.fromCharCode("A".charCodeAt(0)+a),u[a]);k.listClick(c,b,j)}),a(c).on("click."+y,k.settings.listDiv+" li",function(){var c=a(this).data("markerid"),d=u[c];a(k.settings.listDiv+" li").removeClass("list-focus"),a(k.settings.listDiv+" li[data-markerid="+c+"]").addClass("list-focus"),l.panTo(d.getPosition());var e="left";k.settings.bounceMarker===!0?(d.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){d.setAnimation(null),k.createInfowindow(d,e,n,b,j)},700)):k.createInfowindow(d,e,n,b,j)}),a(k.settings.listDiv+" ul li:even").css("background","#"+k.settings.listColor1),a(k.settings.listDiv+" ul li:odd").css("background","#"+k.settings.listColor2)})})},taxonomyFiltering:function(){var b=this;a.each(this.settings.taxonomyFilters,function(a){v[a]=[]}),a(".bh-storelocator-filters-container").on("change."+y,"input, select",function(c){c.stopPropagation();var d,e,f;if(a(this).is('input[type="checkbox"]')){if(b.checkFilters(),d=a(this).val(),e=a(this).closest(".bh-storelocator-filters").attr("id"),f=b.getFilterKey(e))if(a(this).prop("checked"))v[f].push(d),a("#"+b.settings.mapDiv).hasClass("bh-storelocator-map-open")===!0&&(b.reset(),o&&p?(b.settings.mapSettings.zoom=0,b.beginMapping()):b.mapping(k));else{var g=v[f].indexOf(d);g>-1&&(v[f].splice(g,1),a("#"+b.settings.mapDiv).hasClass("bh-storelocator-map-open")===!0&&(b.reset(),o&&p?(b.settings.mapSettings.zoom=0===b.countFilters()?m:0,b.beginMapping()):b.mapping(k)))}}else(a(this).is("select")||a(this).is('input[type="radio"]'))&&(b.checkFilters(),d=a(this).val(),e=a(this).closest(".bh-storelocator-filters").attr("id"),f=b.getFilterKey(e),d?f&&(v[f]=[d],a("#"+b.settings.mapDiv).hasClass("bh-storelocator-map-open")===!0&&(b.reset(),o&&p?(b.settings.mapSettings.zoom=0,b.beginMapping()):b.mapping(k))):(f&&(v[f]=[]),b.reset(),o&&p?(b.settings.mapSettings.zoom=m,b.beginMapping()):b.mapping(k)))})},locator:function(){null!==this.settings.taxonomyFilters&&this.taxonomyFiltering(),this.settings.modalWindow===!0&&(g.wrap('<div class="'+this.settings.overlayDiv+'"><div class="'+this.settings.modalWindowDiv+'"><div class="'+this.settings.modalContentDiv+'">'),a("."+this.settings.modalWindowDiv).prepend('<div class="'+this.settings.modalCloseIconDiv+'"></div>'),a("."+this.settings.overlayDiv).hide()),this.settings.slideMap===!0&&g.hide(),this.start(),this.processFormInput()}}),a.fn[f]=function(b){return this.each(function(){g=a(this),a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))}),this}}}(jQuery,window,document);